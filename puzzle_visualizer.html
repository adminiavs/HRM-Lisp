<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Lisp Dataset Visualizer (Upload Local Folder)</title>
  <style>
    body { font-family: monospace; margin: 16px; }
    .selector-area { margin-bottom: 1rem; }
    .example-container { margin: 16px 0; padding: 8px; border: 1px solid #ccc; }
    .puzzle-display { margin-top: 1rem; }
    .puzzle-id { font-weight: bold; margin-bottom: 0.5rem; }
  </style>
</head>
<body>
<h1>Lisp Dataset Visualizer (Local Directory)</h1>
<p>
  This tool previews datasets generated by <code>dataset/build_lisp_dataset.py</code>.
  Upload the folder at <code>data/lisp-simplification</code> (or your custom output dir) containing
  <code>train/</code>, <code>test/</code>, and an <code>identifiers.json</code> file to browse examples.
  The viewer decodes token ids into human-readable Lisp tokens using <code>identifiers.json</code>.
  No data is uploaded to any server; all processing happens locally in your browser.
  
  For ARC or other datasets, use their respective visualization tools if available.
  
  Tip: The <code>Subset</code> menu will list dataset subsets if present; otherwise, use <code>all</code>.
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </p>
<div class="selector-area">
  <label>Upload Lisp Dataset Folder:</label>
  <input type="file" id="folderInput" webkitdirectory mozdirectory multiple onchange="onFolderSelected(event)" />
  <br><br>
  <label>Set:</label>
  <select id="setSelect" disabled><option value="train">train</option><option value="test">test</option></select>
  <label> Subset:</label>
  <select id="subsetSelect" disabled><option value="all">all</option></select>
  <button id="loadBtn" disabled>Load</button>
</div>
<div>
  <div class="puzzle-display" id="puzzleView"></div>
</div>
<script src="assets/npyjs.js"></script>
<script>
let filesByPath = {};
let inputsArr, labelsArr, identifiersJson;
let seqLen = 0;

function onFolderSelected(event) {
    filesByPath = {};
    const fileList = event.target.files;
    if (!fileList || fileList.length === 0) { alert("No files selected!"); return; }

    const paths = Array.from(fileList).map(file => file.webkitRelativePath || file.mozRelativePath || file.name);
    const idPath = paths.find(p => p.endsWith("identifiers.json"));
    if (!idPath) { alert("Error: No 'identifiers.json' found."); return; }
    const topDir = idPath.includes("/") ? idPath.substring(0, idPath.lastIndexOf("/")) : "";

    for (let file of fileList) {
        let relPath = file.webkitRelativePath || file.mozRelativePath || file.name;
        if (topDir && relPath.startsWith(topDir + "/")) {
            relPath = relPath.substring(topDir.length + 1);
        }
        filesByPath[relPath] = file;
    }
    
    document.getElementById("setSelect").disabled = false;
    document.getElementById("subsetSelect").disabled = false;
    document.getElementById("loadBtn").disabled = false;
}

document.getElementById("loadBtn").addEventListener("click", async () => {
    const setName = document.getElementById("setSelect").value;
    const subsetName = document.getElementById("subsetSelect").value;
    try {
        await loadDataset(setName, subsetName);
        displayPuzzles();
    } catch (err) {
        console.error(err);
        alert("Error loading dataset: " + err);
    }
});

async function loadDataset(setName, subsetName) {
    const prefix = `${setName}/${subsetName}__`;
    const needed = [`${prefix}inputs.npy`, `${prefix}labels.npy`, "identifiers.json"];
    for (const f of needed) {
        if (!filesByPath[f]) throw new Error(`Missing file: ${f}`);
    }

    const [inputsNpy, labelsNpy] = await Promise.all([
        parseNpy(filesByPath[`${prefix}inputs.npy`]),
        parseNpy(filesByPath[`${prefix}labels.npy`])
    ]);
    
    inputsArr = inputsNpy.data;
    labelsArr = labelsNpy.data;
    seqLen = inputsNpy.shape[1];
    identifiersJson = await readJsonFile(filesByPath["identifiers.json"]);
}

function displayPuzzles() {
    const puzzleView = document.getElementById("puzzleView");
    puzzleView.innerHTML = "";
    const numPuzzles = Math.min(inputsArr.length / seqLen, 20); // Show first 20

    for (let i = 0; i < numPuzzles; i++) {
        const inputSeq = slice1D(inputsArr, i * seqLen, (i + 1) * seqLen);
        const labelSeq = slice1D(labelsArr, i * seqLen, (i + 1) * seqLen);
        
        const inputStr = decodeSequence(inputSeq);
        const labelStr = decodeSequence(labelSeq);

        const exDiv = document.createElement("div");
        exDiv.className = "example-container";
        exDiv.innerHTML = `
            <div><strong>Example ${i}</strong></div>
            <div><strong>Input:</strong> ${inputStr}</div>
            <div><strong>Label:</strong> ${labelStr}</div>
        `;
        puzzleView.appendChild(exDiv);
    }
}

function decodeSequence(seq) {
    let tokens = [];
    for (const id of seq) {
        if (id === 0) break; // Stop at padding
        tokens.push(identifiersJson[id]);
    }
    return tokens.join(' ');
}

// Utility functions
function slice1D(arr, start, end) { return arr.slice(start, end); }
function parseNpy(file) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = async () => {
            try { resolve(await new npyjs().parse(reader.result)); } 
            catch (err) { reject(err); }
        };
        reader.onerror = err => reject(err);
        reader.readAsArrayBuffer(file);
    });
}
function readJsonFile(file) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => {
            try { resolve(JSON.parse(reader.result)); } 
            catch (err) { reject(err); }
        };
        reader.onerror = err => reject(err);
        reader.readAsText(file);
    });
}
</script>
</body>
</html>